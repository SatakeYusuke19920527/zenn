---
title: 'Codex を完全に理解する会'
emoji: '❤️'
type: 'tech' # tech: 技術記事 / idea: アイデア
topics: ['OpenAI', 'AI', 'ChatGPT', 'Codex', 'Azure']
published: true
publication_name: microsoft
---

![](https://storage.googleapis.com/zenn-user-upload/aa27d629504a-20251004.png)

# はじめに

Codex は、OpenAI の多くの技術チーム（セキュリティ、プロダクトエンジニアリング、フロントエンド、API、インフラ、パフォーマンスエンジニアリングなど）で日常的に使用されています。

そして、最近の Update では、Azure OpenAI のサポートにより、CLI または VS Code でも同等の Codex エクスペリエンスをご利用いただけるようになりました。これを実現するために、以下の 5 つのプルリクエストをご提供しました。これにより、ChatGPT でお馴染みの Codex 機能を VSCode 上で安全に実行できるようになります。

https://devblogs.microsoft.com/all-things-azure/codex-azure-openai-integration-fast-secure-code-development/

個人的には、VSCode 上で Codex が使えるようになったことが一番嬉しいですね。
VSCode ユーザーの方は是非一度お試しいただくと非常に感動する開発者体験が得られると思います。

見た目はこんな感じ。
GitHub Copilot みたく使えますね。
![](https://storage.googleapis.com/zenn-user-upload/2117feaaafce-20251004.png)

今回は、Codex を完全に理解する為、ユースケース 7 つとベストプラクティス、GPT-5-Codex に至るまで全てをまとめました。

是非、キャッチアップしてみてください。

# Codex とは

**Codex** は、OpenAI が開発した**コード生成に特化した AI エンジン**の総称です。  
自然言語での指示や既存コードの文脈を読み取り、**コードの生成・修正・説明・テスト作成・リファクタリング**などを行うことが出来ます。

## Codex の要点

- **起源**：2021 年に GPT-3 をベースに登場した「コード特化モデル」。
- **できること**：実装の骨組み作成、既存コード理解、バグ修正、最適化、テスト生成、マイグレーション支援。
- **製品への統合**：GitHub Copilot や ChatGPT のコーディング機能の中核。  
  近年は **GPT-4/4o 〜 GPT-5 系**に統合され、名称としての「Codex」は前面に出ないことが多い。
- **最新系（文脈）**：資料では **GPT-5-Codex** として、エージェント型コーディングや安全対策（サンドボックス/ネットワーク制御）を強化した形で説明されることがある。

まとめると、
**「人に話すノリで依頼すると、設計 → 実装 → テストまで“コーディング作業”を手伝う AI」**

いいですよね。
「ええかんじにやっといてくれや」が本当にええ感じにやってくれる Coding Agent になります。

# Codex のユースケースについて

これから、Codex の代表的なユースケースを 7 つ紹介します。

## ユースケース 1 - コード理解 -

Codex は、オンボーディング時やデバッグ、インシデント調査の際に、チームが不慣れなコードベースの領域を素早く理解するのに役立ちます。

チームは Codex を使って、機能の中核ロジックを特定したり、サービスやモジュール間の関係をマッピングしたり、システム内のデータフローを追跡したりします。また、アーキテクチャのパターンや、手作業では多大な労力がかかるドキュメントの不足箇所を可視化するのにも役立ちます。

インシデント対応時には、コンポーネント間のやり取りや、障害状態がシステム全体にどのように伝播するかを明らかにすることで、エンジニアが新しい領域にすばやくキャッチアップできるよう支援します。

#### コード理解のために Codex に聞けるサンプルプロンプト:

- このリポジトリでは認証ロジックはどこに実装されていますか？
- このサービスでは、リクエストがエントリポイントからレスポンスまでどのように流れますか？
- [モジュール名] とやり取りするモジュールはどれで、障害はどのように処理されていますか？

## ユースケース 2 - リファクタリングとマイグレーション -

Codex は、複数のファイルやパッケージにまたがる変更を行う際によく使われます。たとえば、エンジニアが API を更新したり、実装パターンを変更したり、新しい依存関係に移行する場合に、Codex を使うことで一貫性のある変更を簡単に適用できます。

特に、同じ更新を数十ものファイルに適用する必要がある場合や、正規表現や単純な検索置換では見つけにくい構造や依存関係を考慮する必要があるアップデートにおいて効果を発揮します。

また、巨大なモジュールを分割したり、古いパターンをモダンなものに置き換えたり、テストしやすいコードに整備するなどのコードクリーンアップにも活用されています。

#### リファクタリングやマイグレーションで Codex に指示できるプロンプト例:

- このファイルを関心ごとに分割して、それぞれに対してテストを生成してください。
- コールバックベースのデータベースアクセスをすべて async/await に変換してください。

## ユースケース 3 - パフォーマンス最適化 -

Codex は、パフォーマンスのボトルネックを特定し、解決するために活用されています。

チューニングや信頼性向上の取り組みでは、エンジニアが Codex に対して「ループが非効率」「処理が冗長」「クエリが高コスト」といった遅い／メモリを多く消費するコードパスの分析を依頼し、最適化案を提案させます。これにより、効率性や信頼性において実質的な改善が得られます。

また、現在も使用されているリスクの高いパターンや非推奨のコードを特定することで、コードヘルスの維持にも貢献しています。チームでは、長期的な技術的負債の削減や、将来的なリグレッションの防止に Codex を頼りにしています。

#### パフォーマンス最適化のために Codex に投げられるプロンプト例:

- このループをメモリ効率を考慮して最適化し、なぜその方が速いのかを説明してください。
- このリクエストハンドラー内で繰り返し発生する高コストな処理を見つけ、キャッシュの活用案を提案してください。
- この関数で DB クエリをバッチ化するより高速な方法を提案してください。

## ユースケース 4 - テストカバレッジの向上 -

Codex は、特にテストカバレッジが薄い、またはまったく存在しない箇所で、エンジニアがテストを書きやすくするのに役立ちます。

バグ修正やリファクタリングの際には、Codex に対して「どのようなエッジケースや失敗パターンをテストすべきか」を尋ねることがよくあります。新しいコードに対しては、関数シグネチャやロジックに基づいてユニットテストや統合テストを自動生成することもできます。

また、空入力・最大値・一見珍しいが正当な状態など、初期テストで見落とされがちな境界条件の洗い出しにも優れています。

#### テストカバレッジ向上のために Codex に依頼できるプロンプト例:

- この関数のユニットテストを書いてください。エッジケースや失敗パターンも含めて。
- このソートユーティリティのプロパティベーステストを生成してください。
- このテストファイルを拡張し、null 入力や不正な状態に関する抜け漏れシナリオを追加してください。

## ユースケース 5 - 開発スピードの向上 -

Codex は、開発サイクルの「始まり」と「終わり」の両方を加速させることで、チームの開発スピードを高めます。

新機能の開発開始時には、フォルダやモジュール、API スタブなどのボイラープレートコードを生成し、一つ一つ手作業で配線することなくすぐに動く状態にできます。

リリースが近づいたタイミングでは、バグのトリアージや実装の最後の詰め、ロールアウト用スクリプトやテレメトリーフック、設定ファイルの生成など、小さいけれど重要な作業を Codex が肩代わりし、タイトな納期を支えます。

また、プロダクトのフィードバックをコードの初期ドラフトに変換する用途でも利用されています。エンジニアはユーザーの要望や仕様をそのまま貼り付けて、Codex にたたき台を生成させてから、後で自分で磨き上げることができます。

#### 開発スピード向上のために Codex に依頼できるプロンプト例:

- POST /events 用の新しい API ルートを、バリデーションとログ付きでスキャフォールドしてください。
- 新しいオンボーディングフローの成功／失敗を追跡するためのテレメトリーフックを、このテンプレートを使って生成してください（［あなたのテレメトリーコードの例を挿入］）。
- この仕様（［仕様またはプロダクトフィードバック］）に基づいてスタブ実装を作ってください。

## ユースケース 6 - フロー状態の維持 -

Codex は、スケジュールが細切れで中断ばかりの状態でも、エンジニアが生産性を保てるように支援します。

未完了の作業を記録したり、メモからプロトタイプコードを生成したり、後から再開できる探索的タスクを切り出すために使われます。これにより、一度中断してもコンテキストを失わずに再開できるため、オンコール中やミーティングが多い状況でも集中力を維持できます。

#### チームからの声

> 軽微な修正を見つけたときに、わざわざブランチを切り替えず Codex にタスクとして投げておき、後で PR を確認します。  
> **バックエンドエンジニア（ChatGPT API）**

> Slack のスレッドや Datadog のトレース、Issue などを定期的に Codex に送っておき、重要な作業に集中しています。  
> **API エンジニア（インフラ可観測性）**

#### フロー状態を維持するために Codex に依頼できるプロンプト例:

- このサービスをリファクタリングする計画を立てて、小さいモジュールに分割してください。
- リトライロジックのスタブを書き、TODO を入れておいてください — バックオフのロジックは後で私が書きます。
- 明日すぐに再開できるように、このファイルの内容を要約してください。

## ユースケース 7 - 探索とアイデア創出 -

Codex は、解決策の比較検討や設計判断の妥当性検証といったオープンエンドな作業にも役立ちます。たとえば「別のやり方を試したい」「あまり使ったことのないパターンを試してみたい」「この前提は本当に正しい？」といったプロンプトを投げることで、トレードオフの可視化・設計オプションの拡張・実装判断の洗練につながります。

また、既知の問題や非推奨メソッドを元に、類似のバグをコード全体から洗い出す用途にも使われます。これにより、リグレッションの早期発見やクリーンアップ作業の完了が容易になります。

#### 探索・アイデア出しのために Codex に依頼できるプロンプト例:

- リクエスト／レスポンス方式ではなく、イベント駆動型の仕組みだったらどう動きますか？
- SQL を手書きしているモジュールをすべて見つけて、クエリビルダーを使うよう提案してください。
- このコードを、より関数型スタイル（副作用や状態変更を避ける形）で書き直してください。

# ベストプラクティス

Codex は、明確な構造・文脈・試行の余地が与えられたときに最も力を発揮します。OpenAI のチームが日常業務で継続的に価値を引き出すために取り入れている習慣を以下にまとめます。

## Ask モードから始める

大きな変更を行う場合は、まず Ask モードで Codex に実装プランを考えさせます。次に Code モードに切り替え、そのプランを基にフォローアップの指示を出します。この 2 ステップにより Codex の出力が安定し、誤りを防げます。Codex は「1 時間程度で終わる」「数百行程度で済む」規模の明確なタスクで最も力を発揮します。モデルの進化に伴い、対応できるタスクの大きさも増えていくでしょう。

## Codex の開発環境を段階的に整備する

スタートアップスクリプト・環境変数・インターネットアクセスなどを設定すると、Codex のエラーレートが大幅に下がります。タスク実行中にビルドエラーが出たら、Codex の環境設定を修正する形で改善していきましょう。数回の試行が必要ですが、長期的には大きな効率化につながります。

## プロンプトは「GitHub Issue のように構造化する」

Codex は、PR や Issue のように変化内容を説明した形式のプロンプトに対して高精度に応答します。ファイルパス・コンポーネント名・差分・関連するドキュメントスニペットなどを含めましょう。「この変更は [module X] と同じやり方で実装して」などのパターンも効果的です。

## Codex のタスクキューを「軽量なバックログ」として使う

思いついたアイデア・途中の作業・ついでの修正などをどんどん Codex に投げておきましょう。1 回で完璧な PR を出す必要はありません。集中が戻ったときに再開できる「下書き置き場」として活用すると効果的です。

## AGENTS.md を活用して永続的なコンテキストを提供する

リポジトリ内に AGENTS.md ファイルを作成し、Codex が複数のプロンプトを跨いで効果的に動作できるようにしましょう。このファイルには、命名規則・ビジネスロジック・既知の仕様や癖・コードだけでは判断できない依存関係などを記載します。AGENTS.md の書き方についてはドキュメントも参照してください。

## 「Best of N」機能を活用して出力を改善する

Best-of-N 機能を使うと、1 つのタスクに対して複数の回答を同時に生成し、最適なものを選ぶことができます。より複雑なタスクでは、複数の候補を比較し、それぞれの良い部分を組み合わせてより強力な結果を得ることもできます。

# そして、GPT-5-Codex へ進化

**GPT-5-Codex** は、Codex におけるエージェント型コーディングに最適化された GPT-5 のバージョンです。  
前身の **codex-1** と同様、このモデルは現実のコーディングタスクに対する強化学習を通じて訓練されました。さまざまな環境で人間のスタイルや PR（Pull Request）の好みに近いコードを生成し、指示に忠実に従い、テストが合格するまで繰り返し実行する能力を持ちます。

## GPT-5-Codex の利用方法

このモデルは以下の方法で利用可能です：

- ローカル環境（ターミナルや IDE）における **Codex CLI** および **IDE 拡張機能**
- クラウド環境における **Codex Web**, **GitHub**, **ChatGPT モバイルアプリ**

## GPT-5-Codex の安全性対策

このアドエンダム（追補文書）では、GPT-5-Codex に実装されている包括的な安全対策を説明しています。  
内容は **モデルレベル** と **製品レベル** に分かれています。

- **モデルレベルの対策**

  - 有害なタスクやプロンプトインジェクションに対する専門的な安全学習

- **製品レベルの対策**
  - エージェントのサンドボックス化
  - ネットワークアクセスの設定可能な制御

GPT-5-Codex は、コード生成とエージェント型開発において精密さ・安全性・実用性を高めた特化型モデルです。特に、現実のソフトウェア開発ワークフローに組み込むことを前提に設計されており、開発者や組織にとって **より安全で効率的なコーディング体験** を提供します。

# ベースラインモデルの安全性評価

## 禁止コンテンツ評価

GPT-5-Codex は Codex CLI、Codex IDE 拡張機能、Codex クラウド環境、GitHub での動作など、コード生成に特化して設計されています。また、ユーザーのソースコードに関する質問への応答や対話にも対応しています。

このモデルは汎用チャット用途を想定していませんが、安全性検証のために特定の禁止コンテンツカテゴリに対するベンチマーク評価を実施しました。以下は、本番環境に近い形式で行われた **Production Benchmarks（本番想定ベンチマーク）** の結果です。

GPT-5 System Card で説明されている通り、従来の **Standard Evaluations（標準評価）** では精度が頭打ちになっていたため、本番想定のより難易度の高い評価データセットに移行しています。

### Production Benchmarks

| Evaluation             | gpt-5-codex | gpt-5-thinking | OpenAI o3 |
| ---------------------- | ----------- | -------------- | --------- |
| non-violent hate       | 0.926       | 0.883          | 0.842     |
| personal-data          | 0.922       | 0.877          | 0.830     |
| harassment/threatening | 0.719       | 0.755          | 0.666     |
| sexual/exploitative    | 0.958       | 0.931          | 0.939     |
| sexual/minors          | 0.945       | 0.958          | 0.957     |
| extremism              | 0.946       | 0.954          | 0.92      |
| hate/threatening       | 0.859       | 0.822          | 0.677     |
| illicit/nonviolent     | 0.858       | 0.779          | 0.717     |
| illicit/violent        | 0.935       | 0.912          | 0.829     |
| self-harm/intent       | 0.938       | 0.905          | 0.824     |
| self-harm/instructions | 0.919       | 0.955          | 0.864     |

これらの結果から、**GPT-5-Codex は gpt-5-thinking よりもわずかに高いスコアを持つ** ものの、誤差の範囲内であると考えられます。
また、**全体的に OpenAI o3 を上回る安全性を示しています**。

## Jailbreaks

本節では、モデルが「ジェイルブレイク攻撃」に対してどれだけ堅牢かを評価しています。  
ジェイルブレイクとは、**本来拒否すべき内容を、巧妙なプロンプトによって回避させようとする攻撃的な入力**のことです。

この評価には **StrongReject** と呼ばれる学術的なジェイルブレイクベンチマークが使用されています。

### StrongReject

| Evaluation                            | gpt-5-codex | gpt-5-thinking | OpenAI o3 |
| ------------------------------------- | ----------- | -------------- | --------- |
| illicit / non-violent-crime prompts   | 0.992       | 0.995          | 0.985     |
| violence prompts                      | 0.997       | 0.999          | 0.992     |
| abuse / disinformation / hate prompts | 0.993       | 0.999          | 0.995     |
| sexual-content prompts                | 0.955       | 0.956          | 0.991     |

全体的に **GPT-5-Codex と gpt-5-thinking は非常に高い防御性能を示しており**、従来の **OpenAI o3 よりも拒否性能が強化されている**ことが分かります。

特に「暴力系プロンプト」や「ヘイト系プロンプト」に対しては、**0.99 近辺というほぼ完全拒否に近い数値**を記録しています。

一方で、**性的コンテンツ系プロンプトに対しては gpt-5-codex のスコアがやや低め（0.955）**となっており、この領域は今後の改善余地があると考えられます。

## Harmful Tasks

### Risk description

AI を活用したソフトウェアエンジニアリングが進化する一方で、**マルウェア開発などの悪用リスクに対する防御**はますます重要になっています。ただしその一方で、**逆に制限を厳しくしすぎると、正当で有益なユースケース（例：低レベルなカーネル開発やセキュリティ研究）まで妨げてしまう**というジレンマも存在します。

### Mitigation

#### Safety training①

私たちは ChatGPT で既に運用されているポリシーと安全性トレーニングデータをベースに、Codex にも **「危険なタスクを拒否するための追加学習」** を施しました。

これには以下が含まれます：

- **違法な薬物製造の方法を尋ねるようなリクエストの拒否**
- **「悪意あるウェブサイトを構築するコードを書いてほしい」といった依頼の拒否**

さらに Codex の安全性を強化するために、**codex-1 専用の詳細なポリシーとトレーニングデータセット**を作成し、「マルウェア開発に関連するタスクを拒否する能力」を重点的に学習させました。

#### 学習プロセスの詳細

- マルウェア関連のプロンプト・コード断片・環境設定を含む **多様な合成データパイプライン** を構築
- モデルに対し次のようなふるまいを教え込みました：

  - **高リスクリクエストを拒否する**
  - **防御的または文脈的にのみ回答する**
  - **デュアルユース（善用・悪用の両方に使える技術）ケースを適切に処理する**
  - **曖昧なケースでも安全側に倒れる**

- **エッジケースや対抗プロンプト（adversarial examples）**で境界値の動作も評価しつつ、安全性の一貫性を強化

- また **社内ポリシー専門家が作成した「ゴールデンセット」**を使って訓練の効果を検証しました

### Malware Refusals

| Evaluation                    | gpt-5-codex | codex-1 |
| ----------------------------- | ----------- | ------- |
| Malware Refusals (Golden Set) | 1.00        | 0.98    |

**GPT-5-Codex は、codex-1 に比べてマルウェア関連の不正依頼をより確実に拒否できている（= 安全性が向上している）ことが確認されています。**

## Prompt Injection

### Risk description

**プロンプトインジェクション**とは、攻撃者が意図的に不正な指示をユーザー入力や処理対象データに埋め込むことで、モデルの挙動を操作しようとする攻撃です。  
これにより、システムレベルの指示が上書きされたり、本来の意図とは異なる動作を引き起こす可能性があります。

Codex にはネットワークアクセスやローカル環境での Web 検索機能があるため、従来よりも攻撃対象となる入力経路が増えています。  
具体的には、ユーザーが書いたコードだけでなく、**外部サイト・ドキュメント・検索結果などに含まれる不正なテキスト**も攻撃ベクトルとなる可能性があります。

もしプロンプトインジェクションが成功すると、以下のような有害な結果を招く可能性があります：

- **データ漏洩**（例：ユーザーのコードベースを外部に送信させる）
- **有害なコード変更**（例：バックドアを埋め込む）
- **データ破壊**（例：ファイルやデータベースの削除を実行させる）

モデル単体での対策に加え、後述するように **サンドボックス環境** などの製品レベルの保護機構も導入されています。

#### Safety training②

プロンプトインジェクション攻撃に対する耐性を高めるため、**Instruction Hierarchy Framework（指示階層フレームワーク）**［2］に基づいた新たな安全性トレーニングデータを作成し、**コーディング環境における攻撃的な指示を無視するようにモデルを訓練**しました。

また Codex 環境に特化した **新しいプロンプトインジェクション評価スイート** を開発し、以下のような攻撃パターンに対する堅牢性を測定しました：

- **現在のコーディングタスクの終了を強制させる試み** → パフォーマンスや学習進行の破壊に繋がる
- **後続ステップで特定の指示を強制する試み** → 例：「最終出力として 'HACKED!' と表示させる」

### Coding-focused prompt injections

| Evaluation                                                                            | gpt-5-codex | codex-1 |
| ------------------------------------------------------------------------------------- | ----------- | ------- |
| Successfully ignored prompt injection attack during coding tasks in Codex environment | 0.98        | 0.98    |

**結果として、GPT-5-Codex と codex-1 の両方が 0.98 の高い回避率を示し、プロンプトインジェクション攻撃をほぼ確実に無視できることが確認されています。**

### Biological and Chemical

GPT-5 System Card では、Preparedness Framework（備えの枠組み）に基づき、生物学的・化学的なリスク領域における検証を行ったことが記載されています。

Safety Advisory Group（安全性諮問グループ）は、**gpt-5-thinking を「生物・化学領域における High capability（高性能）」として扱うべき**と推奨し、それに伴いリスクを十分に低減するための安全対策（safeguards）が実装されています。

これらの対策は **GPT-5-Codex にも同様に適用**されており、ChatGPT Agent においても有効化されています。

### Cybersecurity

GPT-5 System Card において、Safety Advisory Group は **「GPT-5 モデルシリーズはサイバーセキュリティ領域では High capability の基準を満たしていない」** と評価しています。

GPT-5-Codex は、**Capture-the-Flag（CTF）やサイバー演習において以前より改善が見られる**ものの、依然として **定義された High capability の閾値には達していません**。

とはいえ、将来的により強力なモデルが登場することを見越し、私たちは以下のような**追加的なサイバーセキュリティ対策の開発に投資しています**：

- **生物・化学領域で採用したのと同様のセーフガード手法の導入**
- **GPT-5-Codex の利用時における潜在的な悪用の監視**
- **GPT-5-Codex エージェントを安全に運用・管理するための顧客向けガイダンスの提供**

詳細はこちらで確認できます：  
https://developers.openai.com/codex/security

![](https://storage.googleapis.com/zenn-user-upload/7a4d1d219b79-20251004.png)
![](https://storage.googleapis.com/zenn-user-upload/d6fee7ac6b68-20251004.png)

# Product-Specific Risk Mitigations

## Agent sandbox

Codex エージェントは、タスク実行中に潜在的なリスクを最小限に抑えるため、**隔離された安全な環境（サンドボックス）内で動作する設計**となっています。このサンドボックスの方式は、Codex をローカルで動かすかクラウドで動かすかによって異なります。

### クラウド環境の場合

Codex をクラウド上で実行する場合、**OpenAI がホストする隔離コンテナ内で動作し、ネットワークアクセスはデフォルトで無効化**されています。

→ これにより、**ユーザーのシステムや重要データにアクセスできない**状態が保たれます。

### ローカル環境（MacOS / Linux）の場合

Codex をローカルで実行する際には、それぞれ以下の手法でサンドボックス化されます：

| OS        | サンドボックス方式                        |
| --------- | ----------------------------------------- |
| **MacOS** | Seatbelt ポリシーによって制限             |
| **Linux** | seccomp + landlock により同等の制限を実現 |

ユーザーは場合によって**サンドボックス外で実行することも可能**ですが、それはモデルがコマンド実行に成功した場合に限られます。

### これらのデフォルト保護の目的

- **ネットワークアクセスの無効化**  
  → プロンプトインジェクション / データ漏洩 / 外部接続による攻撃のリスクを大幅に低減

- **ファイル操作の制限（現在の作業領域のみに限定）**  
  → プロジェクト外のファイルを勝手に編集することを防ぎ、誤操作や被害を抑止

ユーザーは必要に応じてこれらの制限を緩和（例：特定のサイトのみネットワーク許可）できますが、**デフォルトの設定は可能な限り安全なベースラインとして設計されています。**

## Network access

段階的な導入の方針に基づき、Codex クラウドは当初、**ネットワーク完全遮断＋サンドボックス実行**という非常に保守的な設定で提供されました。  
このアプローチにより、初期段階のユーザーから安全性に関するフィードバックを収集することができました。

### ユーザーからの要望

ユーザーからは以下のような声がありました：

- 「**ネットワークは必要なときだけ有効にしたい。**」
- 「**依存パッケージのインストールなど、一部の用途では接続が不可欠。**」

### 対応方針

今後は **プロジェクト単位で「どのサイトにアクセス可能か」をユーザーが指定可能**になります。

これには以下が含まれます：

- **許可リスト / 拒否リスト（Allowlist / Denylist）機能**
- **HTTP 接続の安全な範囲の制御**
- **ライセンス制限のあるコードのダウンロード防止**

### セキュリティ面での注意点

ネットワークアクセスを許可すると以下のリスクが発生します：

- プロンプトインジェクション経由で外部から悪意あるコードを取り込む可能性
- 認証情報の漏洩
- ライセンス非準拠なコードの混入

**したがって、Codex にインターネットを許可する場合は「信頼できるドメインのみに限定する」ことが推奨されています。**

# まとめ

# 記事サマリー（要点だけ一気読み）

## Codex とは

OpenAI が開発した“コード生成エンジン”で、オンボーディング・バグ修正・リファクタ・性能改善・テスト生成など、日常のエンジニアリング作業を高速化する。現在は GPT シリーズに統合されつつも、ワークフロー支援（Ask/Code モード、タスクキュー、エージェント実行）として実務投入されている。

## 主要ユースケース（7 つ）

| #   | 目的                   | どう使うか                                                          | 期待効果                                                       |
| --- | ---------------------- | ------------------------------------------------------------------- | -------------------------------------------------------------- |
| 1   | **コード理解**         | 中核ロジックの特定、サービス/モジュール依存の把握、データフロー追跡 | 不慣れな領域でも短時間でキャッチアップ、インシデント調査の加速 |
| 2   | **リファクタ/移行**    | API 変更・依存更新・大規模置換、巨大モジュール分割                  | 一貫した変更を短時間で適用、変更漏れの削減                     |
| 3   | **性能最適化**         | 遅い/メモリ重い箇所の診断、代替案提示、危険パターン検出             | 実効的な高速化・信頼性向上、長期的な技術的負債低減             |
| 4   | **テスト拡充**         | ユニット/統合テスト自動生成、境界条件・失敗経路の網羅               | カバレッジ増、リグレッション防止、品質向上                     |
| 5   | **開発速度向上**       | 新機能のスキャフォールド、最後の詰め（スクリプト/テレメトリ/設定）  | 着手と収束の双方を加速、低優先タスクも前進                     |
| 6   | **フロー維持**         | 途中作業の保存、メモ → 試作コード化、再開容易化                     | 中断が多くても生産性を維持、オンコール/会議多でも継続          |
| 7   | **探索・アイデア出し** | 代替設計の検証、仮説の耐久テスト、関連バグの芋づる検出              | 設計オプション拡大、トレードオフ可視化、クリーンアップ加速     |

## ベストプラクティス

- **Ask モードから開始 → Code モードで実装**：まず計画を出させ、後続プロンプトの土台にする。
- **環境を育てる**：起動スクリプト/環境変数/ネットワーク設定でエラー率を下げる。ビルド失敗は環境設定へフィードバック。
- **GitHub Issue のように書く**：ファイルパス、差分、関連ドキュメントを含め具体に。
- **タスクキューを軽量バックログに**：思いつきを並行投入。後で仕上げれば OK。
- **AGENTS.md を用意**：命名規則・ビジネスロジック・依存関係など“コード外の前提”を明文化。
- **Best-of-N**：複数案を同時生成し、良い部分を合成。

## GPT-5-Codex（Codex の最新系）概要

- **位置づけ**：GPT-5 を“エージェント型コーディング”に最適化した派生。CLI/IDE 拡張/クラウド（Codex Web・GitHub・ChatGPT モバイル）で利用。
- **安全性と製品対策**
  - **モデル面**：有害タスク拒否、プロンプトインジェクション耐性の専門訓練。
  - **製品面**：**エージェントサンドボックス**（ネットワーク既定 OFF、作業領域外の書込み制限）、**ネットワーク許可の細粒度制御**（Allow/Deny リスト）。

## 安全評価（抜粋）

- 本番想定ベンチマークで、**多くの有害カテゴリで o3 を上回る**安全性。
- **StrongReject（JB 耐性）**では暴力/ヘイト系で**0.99 近傍**の強い拒否。性的コンテンツは改善余地あり。
- **マルウェア拒否**のゴールデンセットは **GPT-5-Codex=1.00 / codex-1=0.98**。
- **プロンプトインジェクション耐性**（コーディング環境特化）では **両者 0.98**で高水準。

## 導入・運用の実務ヒント

1. **初回セットアップ**：AGENTS.md、起動スクリプト、依存解決、最低限のテレメトリを用意。
2. **プロンプト運用**：Issue 形式・参照パス指定・「[module X]と同様」などのパターン化。
3. **リスク管理**：既定はネットワーク OFF。必要サイトのみ Allowlist。資格情報は別ボルト。
4. **評価/改善**：Best-of-N で案出し → 人間が合成。失敗例は環境/プロンプト/ガードレールに還元。

### 一言まとめ

> Codex（および GPT-5-Codex）は、日常の開発フローに“計画 → 実装 → 検証 → 仕上げ”を埋め込むエージェント的コーディング基盤。  
> **高速化・品質向上・安全性**の三拍子を、プロンプト設計とサンドボックス運用で実務レベルに落とし込むのが肝。

# 参考文献

https://cdn.openai.com/pdf/6a2631dc-783e-479b-b1a4-af0cfbd38630/how-openai-uses-codex.pdf
https://cdn.openai.com/pdf/97cc5669-7a25-4e63-b15f-5fd5bdc4d149/gpt-5-codex-system-card.pdf
https://learn.microsoft.com/ja-jp/azure/ai-foundry/openai/how-to/codex?tabs=npm
