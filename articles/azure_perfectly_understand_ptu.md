---
title: "【Azure OpenAI】PTU(Provisioned throughput units)について完全に理解する【2024年8月最新版】"
emoji: "🚀"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Azure", "Azure OpenAI","Microsoft", "PTU"]
published: false
publication_name: "microsoft"
---

# 【Azure OpenAI】PTU(Provisioned throughput units)について完全に理解する

本記事では、Azure OpenAIを利用する上で理解しておくべき概念である ```PTU``` について、完全に理解する為の記事です。
```PTU``` とは何か、どのように活用できるのか、利用するとどのようなメリットがあるのか詳細に解説します。

また、Azure OpenAI プロビジョニング オファリングは、購入モデルと Azure 標準との調整や、モデルに依存しないクォータへの移行を含めて、2024 年 8 月 12 日に大規模な更新がありました。
この更新によって何が変わるのかも

## 目次

1. [PTUとは何か？](#ptuとは何か)
2. [PTUの仕組み](#ptuの仕組み)
3. [PTUの利用方法](#ptuの利用方法)
4. [PTUのベストプラクティス](#ptuのベストプラクティス)
5. [PTUとコスト管理](#ptuとコスト管理)
6. [まとめ](#まとめ)

## PTUとは何か？

### 定義と役割

**PTU（Provisioned Throughput Units）**とは、Azure OpenAIサービスで使用される単位で、指定されたスループット（一定時間内に処理できるリクエストの量）を予約する仕組みです。
VMで言うところのリザーブドインスタンスみたいな感じですね。

PTUを利用することで、スケーラブルなAIサービスを提供し、リクエストの高負荷時にも安定したパフォーマンスを維持することができます。





通常、Azureのようなクラウドサービスでは、リクエストの量に応じて自動的にリソースがスケールされます。しかし、急にリクエストが増えると、対応が遅れたり、パフォーマンスが低下することがあります。そこでPTUを使うと、事前に一定の処理能力（スループット）を予約しておくことができるので、リクエストが集中しても安定したパフォーマンスを保てます。


### 背景と必要性

Azure OpenAIは、大規模なAIモデルを提供していますが、それに伴うリクエスト数の増加に対処するためには、適切なスループット管理が求められます。
PTUを利用することで、リクエストが急増した場合でも安定した応答時間を確保できます。

## PTUの仕組み

### スループットとリソースの関連

PTUは、スループット（1秒あたりの処理リクエスト数）と関連付けられており、予め指定したPTUに基づいてリソースが確保されます。これにより、予測可能なパフォーマンスが保証され、ビジネスのニーズに合わせたリソースの確保が可能です。

### スケーリングと負荷分散

PTUは自動スケーリングの一環として機能し、リクエストの負荷に応じて動的にスケールアップまたはダウンすることができます。また、複数のPTUを使用することで、負荷分散が可能になり、パフォーマンスの向上が期待できます。

## PTUの利用方法

### 設定方法

PTUの設定は、Azure PortalまたはCLIを使用して簡単に行うことができます。設定時には、必要なスループット量を予測し、それに応じたPTU数を選択します。詳細な設定手順については、[公式ドキュメント](https://learn.microsoft.com/ja-jp/azure/ai-services/openai/concepts/provisioned-throughput)を参照してください。

### 管理とモニタリング

PTUの利用状況は、Azure Monitorを使用してリアルタイムでモニタリングすることができます。これにより、パフォーマンスのトレンドを分析し、必要に応じてPTUの調整が可能です。

## PTUのベストプラクティス

### 最適なPTUの選定

PTUを選定する際は、予測されるトラフィック量を基に、適切なスループットを確保することが重要です。過剰なPTUの選定はコストを増大させるため、ビジネスニーズに合った適切な規模を選ぶことが求められます。

### コストとパフォーマンスのバランス

PTUのコストは、選択したスループット量に依存します。効率的なコスト管理を行うためには、利用状況に応じてPTUをスケーリングし、無駄のないリソース利用を目指すことが重要です。

## PTUとコスト管理

### コストの可視化と予算管理

PTUを利用することで、コストの可視化が容易になります。Azure Cost Managementを使用して、PTUの利用に伴うコストを追跡し、予算内での運用が可能です。

### オプティマイゼーション戦略

コストを最適化するためには、リクエストのパターンに応じてPTUを動的に調整することが効果的です。ピーク時のスループットを正確に見積もり、必要以上のPTUを割り当てないことがコスト削減のポイントです。

## まとめ

PTUは、Azure OpenAIにおいて重要な役割を果たす要素です。適切なPTUの設定と管理を行うことで、スケーラブルかつコスト効率の高いAIサービスの提供が可能になります。この記事を参考に、PTUの理解を深め、Azure OpenAIを最大限に活用してください。

## Reference Materials
- ![プロビジョニングされたスループットとは](https://learn.microsoft.com/ja-jp/azure/ai-services/openai/concepts/provisioned-throughput) 
- ![Azure OpenAI プロビジョニング 2024 年 8 月の更新プログラム](https://learn.microsoft.com/ja-jp/azure/ai-services/openai/concepts/provisioned-migration)
- ![Azure OpenAI で API 管理による PTU/TPM を使用する - スケーリングの特別なソースを使用する](https://github.com/Azure/aoai-apim/blob/main/README.md)